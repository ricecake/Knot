{erl_opts, [hipe, {i, "inc"}]}.
{plugins, [
    {rebar3_erlydtl_plugin, ".*", {git, "https://github.com/tsloughter/rebar3_erlydtl_plugin.git", {branch, "master"}}}
]}.

{deps, [ 
	{jiffy,   {git, "https://github.com/davisp/jiffy.git",               {branch, "master"}}},
	{erlydtl, {git, "https://github.com/erlydtl/erlydtl.git",            {branch, "master"}}},
	{cowboy,  {git, "https://github.com/extend/cowboy.git",              {branch, "master"}}},
	{snappy,  {git, "https://github.com/fdmanana/snappy-erlang-nif.git", {branch, "master"}}},
	{lager,   {git, "https://github.com/basho/lager",                    {branch, "master"}}}
]}.

{relx, [{release, {'knot', "0.1.0"},
         ['knot',
          sasl]},

        {sys_config, "./config/sys.config"},
        {vm_args, "./config/vm.args"},

        {dev_mode, true},
        {include_erts, false},

        {extended_start_script, true}]
}.

{profiles, [{prod, [{relx, [{dev_mode, false},
                            {include_erts, true}]}]
            }]
}.

{overrides, [{override, merl,
              [{pre_hooks,
                [{"(linux|darwin|solaris)", compile, "make -C \"$REBAR_DEPS_DIR/merl\" all -W test"},
                 {"(freebsd|netbsd|openbsd)", compile, "gmake -C \"$REBAR_DEPS_DIR/merl\" all"},
                 {"win32", compile, "make -C \"%REBAR_DEPS_DIR%/merl\" all -W test"},
                 {eunit,
                  "erlc -I include/erlydtl_preparser.hrl -o test"
                  " test/erlydtl_extension_testparser.yrl"},
                 {"(linux|darwin|solaris)", eunit, "make -C \"$REBAR_DEPS_DIR/merl\" test"},
                 {"(freebsd|netbsd|openbsd)", eunit, "gmake -C \"$REBAR_DEPS_DIR/merl\" test"},
                 {"win32", eunit, "make -C \"%REBAR_DEPS_DIR%/merl\" test"}
                ]}]}]}.
